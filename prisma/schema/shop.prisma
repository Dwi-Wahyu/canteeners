model Shop {
    id          String  @id @default(uuid())
    name        String
    description String?
    image_url   String
    canteen     Canteen @relation(fields: [canteen_id], references: [id])
    canteen_id  Int

    status           ShopStatus @default(ACTIVE)
    suspended_reason String?

    open_time  DateTime?
    close_time DateTime?

    products Product[]
    orders   Order[]
    owner    User      @relation(fields: [owner_id], references: [id])
    owner_id String    @unique

    order_mode ShopOrderMode @default(READY_ONLY) // metode menyiapkan order    

    payments   Payment[]
    complaints ShopComplaint[]

    minimum_price Int?
    maximum_price Int?

    average_rating Float           @default(0)
    total_ratings  Int             @default(0)
    testimonies    ShopTestimony[]

    shop_carts ShopCart[]

    @@index([canteen_id])
    @@index([name])
    @@map("shops")
}

enum ShopOrderMode {
    PREORDER_ONLY // hanya preorder
    READY_ONLY // hanya pemesanan langsung
    BOTH // bisa keduanya
}

enum ShopStatus {
    ACTIVE
    INACTIVE
    SUSPENDED
}

model ShopComplaint {
    id         Int      @id @default(autoincrement())
    created_at DateTime @default(now())

    order    Order?  @relation(fields: [order_id], references: [id])
    order_id String?

    cause String @db.LongText

    shop    Shop?   @relation(fields: [shop_id], references: [id])
    shop_id String?

    @@map("shop_complaints")
}

model Payment {
    id Int @id @default(autoincrement())

    method           PaymentMethod
    qr_url           String?
    account_number   String?
    note             String? // bisa berupa nama akun dan bank
    additional_price Float?

    shop    Shop   @relation(fields: [shop_id], references: [id])
    shop_id String

    @@map("payments")
}

enum PaymentMethod {
    QRIS
    BANK_TRANSFER
    CASH
}

// Todo: bikin model refund

// model Refund {
//   id                String         @id @default(uuid())
//   order_id          String
//   order             Order          @relation(fields: [order_id], references: [id])
  
//   complaint_id      Int?
//   complaint         ShopComplaint? @relation(fields: [complaint_id], references: [id])

//   amount            Decimal        @db.Decimal(10,2)  // jumlah refund
//   reason            RefundReason
//   status            RefundStatus   @default(PENDING)
  
//   requested_at      DateTime       @default(now())
//   processed_at      DateTime?
//   rejected_reason   String?

//   // Siapa yang proses
//   processed_by      String?        // admin_id atau shop_owner_id
//   processed_by_role String?        // "ADMIN" / "SHOP"

//   @@index([order_id])
//   @@index([status])
//   @@index([complaint_id])
//   @@map("refunds")
// }

// enum RefundReason {
//   LATE_DELIVERY        // terlambat > estimasi
//   WRONG_ORDER          // salah pesanan
//   DAMAGED_FOOD         // rusak
//   MISSING_ITEM         // kurang item
//   OTHER                // lain-lain
// }

// enum RefundStatus {
//   PENDING              // menunggu proses
//   APPROVED             // disetujui
//   REJECTED             // ditolak
//   PROCESSED            // uang sudah dikembalikan
//   CANCELLED            // dibatalkan user
// }